{"version":3,"sources":["file:///D:/Tower-Run/Tower-Run/assets/Scripts/UIManager.ts"],"names":["_decorator","Component","Node","director","resources","Prefab","log","instantiate","find","Label","Animation","GameManager","ccclass","property","UIManager","start","on","InGameState","LOAD_SCORE","_loadScore","SCORE_ADDED","_scoreAdded","GameState","GAME_OVER","_showGameOverUI","CHECK_POINT","scoreNum","pos","isCoin","load","err","prefab","score","getComponent","string","setParent","setPosition","label","scoreLabel","_curScore","Number","String","anim","play","win","scheduleOnce","gameOverTitle","totalScoreLabel","gameOverNode","active","playAgain","emit","INIT","gotoMenu","loadScene"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,G,OAAAA,G;AAAKC,MAAAA,W,OAAAA,W;AAAmBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,S,OAAAA,S;;AAC/FC,MAAAA,W,gBAAAA,W;;;;;;;AACDC,MAAAA,O,GAAsBZ,U,CAAtBY,O;AAASC,MAAAA,Q,GAAab,U,CAAba,Q;;2BAGJC,S,WADZF,OAAO,CAAC,WAAD,C,UAGHC,QAAQ,CAACX,IAAD,C,UAGRW,QAAQ,CAACX,IAAD,C,UAERW,QAAQ,CAACJ,KAAD,C,UAERI,QAAQ,CAACJ,KAAD,C;;;;;;;;;;;;;;;;;;;;sEAImB,C;;;;;;;eAG5BM,K,GAAA,iBAAS;AACLZ,UAAAA,QAAQ,CAACa,EAAT,CAAY;AAAA;AAAA,0CAAYC,WAAZ,CAAwBC,UAApC,EAAgD,KAAKC,UAArD,EAAiE,IAAjE;AACAhB,UAAAA,QAAQ,CAACa,EAAT,CAAY;AAAA;AAAA,0CAAYC,WAAZ,CAAwBG,WAApC,EAAiD,KAAKC,WAAtD,EAAmE,IAAnE;AAEAlB,UAAAA,QAAQ,CAACa,EAAT,CAAY;AAAA;AAAA,0CAAYM,SAAZ,CAAsBC,SAAlC,EAA6C,KAAKC,eAAlD,EAAmE,IAAnE;AACArB,UAAAA,QAAQ,CAACa,EAAT,CAAY;AAAA;AAAA,0CAAYM,SAAZ,CAAsBG,WAAlC,EAA+C,KAAKD,eAApD,EAAqE,IAArE;AACH,S;;eAGOL,U,GAAR,oBAAmBO,QAAnB,EAAqCC,GAArC,EAAgDC,MAAhD,EAAyE;AAAA,cAAzBA,MAAyB;AAAzBA,YAAAA,MAAyB,GAAP,KAAO;AAAA;;AACrExB,UAAAA,SAAS,CAACyB,IAAV,CAAe,OAAf,EAAwBxB,MAAxB,EAAgC,UAACyB,GAAD,EAAWC,MAAX,EAA8B;AAC1D,gBAAID,GAAJ,EAAS;AACLxB,cAAAA,GAAG,CAAC,aAAD,EAAgBwB,GAAhB,CAAH;AACA;AACH;;AAED,gBAAIE,KAAW,GAAGzB,WAAW,CAACwB,MAAD,CAA7B;AACAC,YAAAA,KAAK,CAACC,YAAN,CAAmBxB,KAAnB,EAA2ByB,MAA3B,GAAoCN,MAAM,wCAAaF,QAAb,UAA+BA,QAAzE;AACAM,YAAAA,KAAK,CAACG,SAAN,CAAgB3B,IAAI,CAAC,WAAD,CAApB;AACAwB,YAAAA,KAAK,CAACI,WAAN,CAAkBT,GAAlB;AAEH,WAXD;AAaH,S;;eAGON,W,GAAR,qBAAoBK,QAApB,EAAsC;AAClC,cAAIW,KAAK,GAAG,KAAKC,UAAL,CAAgBL,YAAhB,CAA6BxB,KAA7B,CAAZ;AACA,eAAK8B,SAAL,GAAiBC,MAAM,CAACH,KAAK,CAACH,MAAP,CAAN,GAAuBR,QAAxC;AACAW,UAAAA,KAAK,CAACH,MAAN,GAAeO,MAAM,CAAC,KAAKF,SAAN,CAArB;AAEA,cAAIG,IAAI,GAAG,KAAKJ,UAAL,CAAgBL,YAAhB,CAA6BvB,SAA7B,CAAX;AACAgC,UAAAA,IAAI,CAACC,IAAL,CAAU,aAAV;AACH,S;;eAGOnB,e,GAAR,yBAAwBoB,GAAxB,EAA8C;AAAA;;AAAA,cAAtBA,GAAsB;AAAtBA,YAAAA,GAAsB,GAAP,KAAO;AAAA;;AAC1C,eAAKC,YAAL,CAAkB,YAAM;AACpB,YAAA,MAAI,CAACC,aAAL,CAAmBZ,MAAnB,GAA4BU,GAAG,GAAG,MAAH,GAAY,MAA3C;AACA,YAAA,MAAI,CAACG,eAAL,CAAqBb,MAArB,sCAAsC,MAAI,CAACK,SAA3C;AACA,YAAA,MAAI,CAACS,YAAL,CAAkBC,MAAlB,GAA2B,IAA3B;AACH,WAJD,EAIG,GAJH;AAKH,S;;eAGOC,S,GAAR,qBAAoB;AAChB,cAAIb,KAAK,GAAG,KAAKC,UAAL,CAAgBL,YAAhB,CAA6BxB,KAA7B,CAAZ;AACA4B,UAAAA,KAAK,CAACH,MAAN,GAAe,MAAf;AAEA,eAAKc,YAAL,CAAkBC,MAAlB,GAA2B,KAA3B;AACA9C,UAAAA,QAAQ,CAACgD,IAAT,CAAc;AAAA;AAAA,0CAAY7B,SAAZ,CAAsB8B,IAApC;AACH,S;;eAGOC,Q,GAAR,oBAAmB;AACflD,UAAAA,QAAQ,CAACmD,SAAT,CAAmB,MAAnB,EAA2B,YAAM;AAC7BhD,YAAAA,GAAG,CAAC,mBAAD,CAAH;AACH,WAFD;AAGH,S;;;QA1E0BL,S;;;;;iBAGR,I;;;;;;;iBAGE,I;;;;;;;iBAEE,I;;;;;;;iBAEE,I","sourcesContent":["\r\nimport { _decorator, Component, Node, director, resources, Prefab, log, instantiate, Vec3, find, Label, Animation, game } from 'cc';\r\nimport { GameManager } from './GameManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('UIManager')\r\nexport class UIManager extends Component {\r\n\r\n    @property(Node)\r\n    scoreLabel: Node = null!\r\n\r\n    @property(Node)\r\n    gameOverNode: Node = null!\r\n    @property(Label)\r\n    gameOverTitle: Label = null!\r\n    @property(Label)\r\n    totalScoreLabel: Label = null!\r\n\r\n\r\n    private _curScore: number = 0\r\n    \r\n\r\n    start () {\r\n        director.on(GameManager.InGameState.LOAD_SCORE, this._loadScore, this)\r\n        director.on(GameManager.InGameState.SCORE_ADDED, this._scoreAdded, this)\r\n\r\n        director.on(GameManager.GameState.GAME_OVER, this._showGameOverUI, this)\r\n        director.on(GameManager.GameState.CHECK_POINT, this._showGameOverUI, this)\r\n    }\r\n\r\n\r\n    private _loadScore(scoreNum: number, pos: Vec3, isCoin: boolean = false) {\r\n        resources.load(\"score\", Prefab, (err: any, prefab: Prefab) => {\r\n            if (err) {\r\n                log(\"prefab err:\", err)\r\n                return\r\n            }\r\n\r\n            let score: Node = instantiate(prefab)\r\n            score.getComponent(Label)!.string = isCoin ? `额外分数！+ ${scoreNum}` : `+ ${scoreNum}`\r\n            score.setParent(find(\"Canvas/UI\"))\r\n            score.setPosition(pos)\r\n\r\n        })\r\n        \r\n    }\r\n\r\n\r\n    private _scoreAdded(scoreNum: number) {\r\n        let label = this.scoreLabel.getComponent(Label)!\r\n        this._curScore = Number(label.string) + scoreNum\r\n        label.string = String(this._curScore)\r\n\r\n        let anim = this.scoreLabel.getComponent(Animation)!\r\n        anim.play(\"score_added\")\r\n    }\r\n\r\n\r\n    private _showGameOverUI(win: boolean = false) {\r\n        this.scheduleOnce(() => {\r\n            this.gameOverTitle.string = win ? \"游戏胜利\" : \"游戏失败\"\r\n            this.totalScoreLabel.string = `本局得分：${this._curScore} 分`\r\n            this.gameOverNode.active = true\r\n        }, 1.5)\r\n    }\r\n\r\n\r\n    private playAgain() {\r\n        let label = this.scoreLabel.getComponent(Label)!\r\n        label.string = \"0000\"\r\n\r\n        this.gameOverNode.active = false\r\n        director.emit(GameManager.GameState.INIT)\r\n    }\r\n\r\n\r\n    private gotoMenu() {\r\n        director.loadScene(\"menu\", () => {\r\n            log('menu scene loaded')\r\n        })\r\n    }\r\n\r\n\r\n    \r\n}"]}