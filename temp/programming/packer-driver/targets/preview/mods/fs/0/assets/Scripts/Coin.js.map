{"version":3,"sources":["file:///D:/Tower-Run/Tower-Run/assets/Scripts/Coin.ts"],"names":["_decorator","Component","director","BoxCollider","Block","GameManager","ccclass","property","Coin","start","collider","node","getComponent","on","_onTriggerEnter","update","dt","_isAscend","curPos","getPosition","setPosition","x","y","z","event","otherCollider","name","blockComp","isPlayerNodeChild","_inProcess","emit","InGameState","LOAD_SCORE","scheduleOnce","destroy"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,Q,OAAAA,Q;AAAqBC,MAAAA,W,OAAAA,W;;AAClDC,MAAAA,K,UAAAA,K;;AACAC,MAAAA,W,gBAAAA,W;;;;;;;AACDC,MAAAA,O,GAAsBN,U,CAAtBM,O;AAASC,MAAAA,Q,GAAaP,U,CAAbO,Q;;sBAGJC,I,WADZF,OAAO,CAAC,MAAD,C;;;;;;;;;;;;uEAG0B,K;;sEACD,K;;;;;;;eAE7BG,K,GAAA,iBAAQ;AACJ,cAAIC,QAAQ,GAAG,KAAKC,IAAL,CAAUC,YAAV,CAAuBT,WAAvB,CAAf;AACAO,UAAAA,QAAQ,CAACG,EAAT,CAAY,gBAAZ,EAA8B,KAAKC,eAAnC,EAAoD,IAApD;AACH,S;;eAEDC,M,GAAA,gBAAOC,EAAP,EAAmB;AACf,cAAI,KAAKC,SAAT,EAAoB;AAChB,gBAAIC,MAAY,GAAG,KAAKP,IAAL,CAAUQ,WAAV,EAAnB;AACA,iBAAKR,IAAL,CAAUS,WAAV,CAAsBF,MAAM,CAACG,CAA7B,EAAgCH,MAAM,CAACI,CAAP,GAAW,KAAGN,EAA9C,EAAkDE,MAAM,CAACK,CAAzD;AACH;AAEJ,S;;eAGOT,e,GAAR,yBAAwBU,KAAxB,EAA8C;AAAA;;AAC1C,cAAIA,KAAK,CAACC,aAAN,CAAoBC,IAApB,KAA6B,oBAAjC,EAAuD;AACnD,gBAAIC,SAAS,GAAGH,KAAK,CAACC,aAAN,CAAoBd,IAApB,CAAyBC,YAAzB;AAAA;AAAA,+BAAhB;;AAEA,gBAAIe,SAAS,CAACC,iBAAV,IAA+B,CAAC,KAAKC,UAAzC,EAAqD;AACjD,mBAAKA,UAAL,GAAkB,IAAlB;AACA3B,cAAAA,QAAQ,CAAC4B,IAAT,CAAc;AAAA;AAAA,8CAAYC,WAAZ,CAAwBC,UAAtC,EAAkD,IAAlD,EAAwD,KAAKrB,IAAL,CAAUQ,WAAV,EAAxD,EAAiF,IAAjF;AACA,mBAAKF,SAAL,GAAiB,IAAjB;AACA,mBAAKgB,YAAL,CAAkB,YAAM;AACpB,gBAAA,MAAI,CAACtB,IAAL,CAAUuB,OAAV;AACH,eAFD,EAEG,GAFH,EAJiD,CAMzC;AACX;AACJ;AAEJ,S;;;QAjCqBjC,S","sourcesContent":["\r\nimport { _decorator, Component, Node, director, Vec3, log, BoxCollider, ITriggerEvent } from 'cc';\r\nimport { Block } from './Block';\r\nimport { GameManager } from './GameManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Coin')\r\nexport class Coin extends Component {\r\n\r\n    private _inProcess: boolean = false\r\n    private _isAscend: boolean = false\r\n\r\n    start() {\r\n        let collider = this.node.getComponent(BoxCollider)!\r\n        collider.on('onTriggerEnter', this._onTriggerEnter, this)\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this._isAscend) {\r\n            let curPos: Vec3 = this.node.getPosition()\r\n            this.node.setPosition(curPos.x, curPos.y + 10*dt, curPos.z)\r\n        }\r\n        \r\n    }\r\n\r\n\r\n    private _onTriggerEnter(event: ITriggerEvent) {\r\n        if (event.otherCollider.name === 'block<BoxCollider>') {\r\n            let blockComp = event.otherCollider.node.getComponent(Block)!\r\n\r\n            if (blockComp.isPlayerNodeChild && !this._inProcess) {\r\n                this._inProcess = true\r\n                director.emit(GameManager.InGameState.LOAD_SCORE, 5000, this.node.getPosition(), true)\r\n                this._isAscend = true\r\n                this.scheduleOnce(() => {\r\n                    this.node.destroy()\r\n                }, 0.8) // 给 0.8 秒灯动画播放完后销毁\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n}\r\n"]}