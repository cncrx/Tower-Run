{"version":3,"sources":["file:///D:/Tower-Run/Tower-Run/assets/Scripts/MenuUIManager.ts"],"names":["_decorator","Component","Node","director","log","MeshRenderer","sys","ccclass","property","MenuUIManager","start","_playerMesh","player","getComponent","_blockMesh","block","_getSkinID","startGame","mainNode","active","guideNode","loadingNode","preloadScene","scheduleOnce","loadScene","changeSkin","e","params","model","split","action","_playerSkinCurID","_playerSkinMaxID","_setSkin","_storageData","_blockSkinCurID","_blockSkinMaxID","localStorage","getItem","skinID","setMaterial","getMaterial","key","val","setItem","showGuide","hideGuide"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, director, find, game, instantiate, Label, log, Prefab, resources, Vec3, MeshRenderer, sys, error } from 'cc';\r\nimport { GameManager } from './GameManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MenuUIManager')\r\nexport class MenuUIManager extends Component {\r\n\r\n    @property(Node)\r\n    mainNode: Node = null!\r\n    @property(Node)\r\n    guideNode: Node = null!\r\n    @property(Node)\r\n    loadingNode: Node = null!\r\n\r\n    @property(Node)\r\n    player: Node = null!\r\n    @property(Node)\r\n    block: Node = null!\r\n\r\n\r\n    private _playerSkinCurID: number = 1\r\n    private _playerSkinMaxID: number = 4\r\n\r\n    private _blockSkinCurID: number = 1\r\n    private _blockSkinMaxID: number = 5\r\n\r\n    private _playerMesh: MeshRenderer = null!\r\n    private _blockMesh: MeshRenderer = null!\r\n\r\n    start() {\r\n        this._playerMesh = this.player.getComponent(MeshRenderer)!\r\n        this._blockMesh = this.block.getComponent(MeshRenderer)!\r\n\r\n        this._getSkinID()\r\n    }\r\n\r\n\r\n    private startGame() {\r\n        this.mainNode.active = false\r\n        this.guideNode.active = false\r\n        this.loadingNode.active = true\r\n\r\n        director.preloadScene(\"game\", () => {\r\n            log('game scene pre loaded')\r\n        })\r\n\r\n        this.scheduleOnce(() => {\r\n            director.loadScene(\"game\", () => {\r\n                log('game scene loaded')\r\n            })\r\n        }, 2) // 给 2 秒等加载条走完\r\n    }\r\n    \r\n\r\n    private changeSkin(e: Event, params: string) {\r\n        const model: string = params.split(';')[0]\r\n        const action: string = params.split(';')[1]\r\n        \r\n        if (model === 'player') {\r\n            if (action === 'perv')\r\n                this._playerSkinCurID === 2 ? this._playerSkinCurID = this._playerSkinMaxID : this._playerSkinCurID --\r\n\r\n            else if (action === 'next')\r\n                this._playerSkinCurID === this._playerSkinMaxID ? this._playerSkinCurID = 2 : this._playerSkinCurID ++\r\n\r\n            this._setSkin('player', this._playerSkinCurID)\r\n            this._storageData('player', this._playerSkinCurID)\r\n        }\r\n\r\n        else if (model === 'block') {\r\n            if (action === 'perv')\r\n                this._blockSkinCurID === 2 ? this._blockSkinCurID = this._blockSkinMaxID : this._blockSkinCurID --\r\n\r\n            else if (action === 'next')\r\n                this._blockSkinCurID === this._blockSkinMaxID ? this._blockSkinCurID = 2 : this._blockSkinCurID ++\r\n\r\n            this._setSkin('block', this._blockSkinCurID)\r\n            this._storageData('block', this._blockSkinCurID)\r\n        }\r\n    }\r\n\r\n\r\n    private _getSkinID() {\r\n        this._playerSkinCurID = sys.localStorage.getItem('player')\r\n        this._blockSkinCurID = sys.localStorage.getItem('block')\r\n\r\n        this._playerSkinCurID ? this._setSkin('player', this._playerSkinCurID) : this._playerSkinCurID = 2\r\n        this._blockSkinCurID ? this._setSkin('block', this._blockSkinCurID) : this._blockSkinCurID = 2\r\n    }\r\n    \r\n\r\n    private _setSkin(model: string, skinID: number) {\r\n        if (model === 'player') {\r\n            this._playerMesh.setMaterial(this._playerMesh.getMaterial(skinID), 0)\r\n        } else if (model === 'block') {\r\n            this._blockMesh.setMaterial(this._blockMesh.getMaterial(skinID), 0)\r\n        }\r\n    }\r\n\r\n\r\n    private _storageData(key: string, val: number) {\r\n        sys.localStorage.setItem(key, val)\r\n        log(key + \" skin ID: \" + sys.localStorage.getItem(key) + \" stored\")\r\n    }\r\n\r\n\r\n    \r\n\r\n\r\n    private showGuide() {\r\n        this.guideNode.active = true\r\n    }\r\n\r\n\r\n    private hideGuide() {\r\n        this.guideNode.active = false\r\n    }\r\n\r\n}"]}